---
title: 'Database events'
metaTitle: 'Database events with Prisma Pulse'
metaDescription: 'Learn about database change events in Prisma Pulse, their structure, delivery semantics, and more.'
tocDepth: 4
toc: true
---

## Structure

The structure of a database change event depends on the kind of operation that was performed. You can learn more in the [API reference](/pulse/api-reference).

### `create`

```js
{
  action: 'create',
  created: { id: 3, email: 'jane@prisma.io', name: 'Jane Doe' },
  id: '0/2A5A590',
  modelName: 'User'
}
```

### `update`

```js
{
  action: 'update',
  after: { id: 2, email: 'jane@prisma.io', name: 'Jane Doe' },
  before: null,
  id: '0/2A5A248',
  modelName: 'User'
}
```

> **Note**: If you want the `before` field to carry the values of the record _before_ it was updated, you need to set `REPLICA IDENTITY` to `FULL` as explained [here](/pulse/database-setup/general-database-instructions#replica-identity).

### `delete`

Here is an example:

```js
 {
  action: 'delete',
  deleted: { id: 1 },
  id: '0/2A5A398',
  modelName: 'User'
}
```

> **Note**: If you want the `deleted` field to carry the values of the record that was deleted, you need to set `REPLICA IDENTITY` to `FULL` as explained [here](/pulse/database-setup/general-database-instructions#replica-identity). Otherwise it will only carry the `id` value of the record.


## Delivery semantics

This section gives an overview of the event delivery semantics of Prisma Pulse. 

### What are event delivery semantics?

Event delivery semantics describe  the _guarantees_ an event producer can provide about the delivery of events in an event-driven architecture. 

There generally are three kinds of delivery guarantees:
- **At most once**: The event is delivered either once or not at all.
- **At least once**: The event is delivered one or more times, ensuring it never goes undelivered.
- **Exactly once**: The event is delivered exactly once, avoiding duplicates.

### Event delivery semantics in Prisma Pulse

Here is a summary of the event delivery semantics in Prisma Pulse:

|                              | `stream()`                         | `subscribe()`                                   |
| :--------------------------- | :--------------------------------- | :---------------------------------------------- |
| **Persists events**          | Yes                                | No                                              |
| **Delivery guarantees**      | At least once                      | At most once                                    |
| **Event order**              | Same order as events were produced | Maybe different order than events were produced |
| **Can "replay" lost events** | Yes                                | No                                              |

#### `stream()`

When using `stream()`, Prisma Pulse provides the following delivery guarantees.

##### At least once delivery

When streaming database change events with `stream()`, database change events are guaranteed to be delivered with _at least once_ semantics, meaning that Prisma Pulse can guarantee that any event happening in the database will be delivered one or more times.

##### Delivery of events in the right order

Prisma Pulse further guarantees to deliver the database change events in the order they were produced. 

##### Exactly once delivery

While Pulse by default offers _at least once_ semantics, it also provides the _primitives_ for you to implement _exactly once_ delivery guarantees yourself!

Each event produced by Prisma Pulse carries an identifier/idempotency key that you can use to deduplicate during downstream processing of the event. This is best implemented by passing the identifier along to external services that support idempotency or using concepts like upsert when working with a database.

The `id` field in this event payload for a `User` model represent the identifier/idempotency key:

```js
{
  action: 'update',
  after: { id: 1, name: 'Jane', email: "doe@prisma.io" },
  before: null,
  // highlight-next-line
  id: '01HYBEER1JPSBVPG2NQADNQTA6',
  modelName: 'User'
}
```

#### `subscribe()`

##### At most once delivery

When streaming database change events with `.subscribe()`, database change events are guaranteed to be delivered with _at most once_ semantics, meaning that some of the database events may get lost.

##### No guarantees about the order of the events

`subscribe()` doesn't provide any guarantees about the order in which events will arrive.

## Event persistence

The ability to persist events enables the _at least once_ delivery guarantees provided by `stream()`. Prisma Pulse, you need to use `stream()` and configure your Pulse in your Console [project](/platform/about#project) to use **Event persistence**.