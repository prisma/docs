---
title: 'How to build real-time durable workflows'
metaTitle: 'How to build real-time durable workflows with Pulse and Inngest'
metaDescription: 'Learn how to create real-time, durable, and extensible workflows using Prisma Pulse and Inngest.'
sidebar_label: 'Real-time durable workflows'
image: '/img/guides/real-time-durable-workflows-cover.svg'
tags:
  - real-time
  - workflows
  - durable
  - automation
  - prisma
  - inngest
  - pulse
---

## Introduction

Building web applications today isn't just about functionalityâ€”it's about creating seamless and engaging user experiences. Users expect applications to be responsive, real-time, and feature-rich, handling ever-increasing data sets efficiently. This guide will show you how to use Prisma Pulse and Inngest to create real-time, durable workflows that enhance your application's functionality.

## Prerequisites

Before starting this guide, make sure you have:

- Node.js installed (version 18 or higher)
- A PostgreSQL database
- An [Inngest](https://www.inngest.com) account
- The [Pulse/Inngest router service](https://github.com/prisma/pulse-inngest-router) repository
- An OpenAI API key (for the AI writer example)

## 1. Set up your project

### 1.1. Create a new project

First, clone the Pulse/Inngest router repository and install the necessary dependencies:

```bash
git clone https://github.com/prisma/pulse-inngest-router
cd pulse-inngest-router
npm install
```

### 1.2. Define the data model

Initialize Prisma and create your data model:

```bash
npx prisma init
```

Add the following model to your `schema.prisma`:

```prisma
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Article {
  id        Int      @id @default(autoincrement())
  title     String
  content   String
  status    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

### 1.3. Run database migration

Apply the database schema:

```bash
npx prisma migrate dev --name init
```

## 2. Implement user onboarding workflow

### 2.1. Set up Prisma Pulse stream

Create a file called `user-stream.ts`:

```typescript
import { prisma } from './prismaClient';

async function main() {
  const stream = await prisma.user.stream({
    create: {},
  });

  for await (let event of stream) {
    const newUser = event.created;
    await inngest.send('user.signed_up', { data: newUser });
  }
}

main().catch((e) => {
  console.error(e);
  process.exit(1);
});
```

### 2.2. Create onboarding workflow

Create a file called `onboarding-workflow.ts`:

```typescript
import { inngest } from './inngestClient';

export const userOnboarding = inngest.createFunction(
  'User Onboarding',
  'user.signed_up',
  async ({ event, step }) => {
    const { email } = event.data;

    await step.run('Send Welcome Email', async () => {
      await sendEmail(email, 'Welcome to our platform!');
    });

    await step.sleep('Wait 3 Days', 3 * 24 * 60 * 60 * 1000);

    await step.run('Send Follow-Up Email', async () => {
      await sendEmail(email, 'We hope you're enjoying our platform!');
    });
  }
);
```

## 3. Implement AI writer workflow

### 3.1. Set up Pulse/Inngest router

Clone and set up the Pulse/Inngest router:

```bash
git clone https://github.com/prisma/pulse-inngest-router
cd pulse-inngest-router
npm install
```

### 3.2. Create AI writer workflow

Create a file called `ai-writer-workflow.ts`:

```typescript
import { inngest } from './inngestClient';
import { openai } from './openaiClient';

export const aiWriterWorkflow = inngest.createFunction(
  'AI Writer Workflow',
  'db/article.update',
  async ({ event, step }) => {
    const { id, content, status } = event.data;

    if (status === 'REVIEW') {
      const suggestions = await step.run('Generate Suggestions', async () => {
        return await openai.generateSuggestions(content);
      });

      await step.run('Save Suggestions', async () => {
        await prisma.suggestion.create({
          data: {
            articleId: id,
            suggestions,
          },
        });
      });

      await step.waitForEvent('db/article.update', {
        'data.id': id,
        'data.status': 'PUBLISH',
      }, 7 * 24 * 60 * 60 * 1000);

      await step.run('Send Publication Notification', async () => {
        await sendNotification(`Article ${id} has been published.`);
      });
    }
  }
);
```

## 4. Deploy and test

### 4.1. Set up environment variables

Create a `.env` file with your credentials:

```
DATABASE_URL="your-database-url"
INNGEST_EVENT_KEY="your-inngest-key"
OPENAI_API_KEY="your-openai-key"
```

### 4.2. Start the services

Start both the Pulse stream and Inngest functions:

```bash
npm run start:stream
npm run start:functions
```

## Next steps

Now that you have working real-time workflows, you can:

- Add error handling and retries
- Implement more complex workflow patterns
- Add monitoring and observability
- Scale your workflows with additional steps

For more information and updates:
- [Get started with Inngest](https://www.inngest.com)
- [Get started with Pulse](https://www.prisma.io/pulse)
- Join our [Discord community](https://discord.com/invite/prisma)
