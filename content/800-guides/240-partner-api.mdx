---
title: 'Partner Database Provisioning & User Claim Flow'
metaTitle: 'Partner Database Provisioning & User Claim Flow'
description: 'Learn how to use the Prisma Postgres Partner API to provision and claim databases'
sidebar_label: 'Partner API'
image: '/img/guides/prisma-partner-api-cover.png'
community_section: true
---

## Introduction

This guide walks you through how to use the Prisma Postgres Partner API, which powers the [`npx create-db`](https://create-db.prisma.io/) command.

You'll learn how to provision a Prisma Postgres database on your workspace as a partner, how you can transfer it to another user's workspace to allow them to "claim" the database, and how the process is secured using OAuth2. By the end, you'll understand the full flow and how to leverage it to integrate Prisma Postgres in your own product experience.

This guide references the actual implementation in the `npx create-db` CLI and Cloudflare Workers as a real world example. The repo for the `npx create-db` is [here](https://github.com/prisma/create-db) which can be used as a reference for how to use the Partner API in your own projects.

:::note How does this fit into your app?
The two workers in this guide are just reference examples. You would typically build this logic into your own backend or serverless functions.

Similarly, the `npx create-db` CLI is a simple demo. In your product, you can trigger the same API calls from your own UI or onboarding flows to create a seamless experience for your users.
:::

## Overview

This guide explains how to use the Prisma Postgres Partner API to provision a database for your users, and how to enable them to claim ownership of it securely using OAuth2. You'll learn the end-to-end flow, from creating a database as a partner to transferring it to a user's workspace.

## How to become a partner

To use the Prisma Postgres Partner API, you first need to set up as a partner:

2. **Request access to the Partner API**: Contact the Prisma team from the [Prisma Partners page](https://www.prisma.io/partners) to request access to the Partner API. You will be guided through the onboarding process.
3. **Obtain OAuth credentials**: Once approved, you will receive an OAuth client ID and client secret. These credentials are required to authenticate your integration and enable secure database transfers for your users.

For a complete list of available endpoints and details on request/response formats, see the [Prisma Management API documentation](/postgres/database/api-reference/management-api).

## 1. Provisioning a database

To provision a new Prisma Postgres database for your users as a partner:

1. **Collect user input** (such as region, database name, or other options) from your app's UI or flow.
2. **Call the Partner API**:  
  Send a `POST` request to `https://api.prisma.io/v1/projects` with the required details and your integration token.
3. **Handle the response**:  
  The API will return the new database's connection strings and a `project_id`. You can display these to your user or use them in your app.

**Example API call:**

```ts
const prismaResponse = await fetch('https://api.prisma.io/v1/projects', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    Authorization: `Bearer <YOUR_INTEGRATION_TOKEN>`,
  },
  body: JSON.stringify({ region, name }),
});
```

If successful, you'll receive the new project's details, including connection strings and a `project_id`.

## 2. Beginning the claim flow

To let your users claim ownership of a provisioned database, start the claim flow in your product. The goal is to begin a process that will authenticate the user and allow them to select a workspace for the database.

For example, you might have a button labeled "Claim Database" that calls your backend or serverless function to start the flow.

:::note

The [`npx create-db`](https://github.com/prisma/create-db) CLI starts this flow by displaying a claim link, but you can trigger it however fits your product.

:::

## 3. Authenticating the user

When the user initiates the claim flow, redirect them to Prisma Auth using an OAuth2 authorization URL. This allows the user to authenticate (if needed) and select the workspace where they want to claim the database.

Example code to construct the authorization URL:

```ts
const authParams = new URLSearchParams({
  client_id: YOUR_CLIENT_ID,
  redirect_uri: 'https://your-app.com/auth/callback', // Your callback endpoint
  response_type: 'code',
  scope: 'workspace:admin', // The scope of the OAuth2 authorization
  state: generateState(), // Securely track the session
});
const authUrl = `https://auth.prisma.io/authorize?${authParams.toString()}`;
// Redirect the user to authUrl
```

After login and workspace selection, Prisma Auth will redirect back to your callback endpoint with a `code` and `state` *(and any other relevant parameters, such as `project_id` in the case of the `npx create-db` CLI)*.

## 4. Finishing the claim flow

After your callback endpoint receives the `code` (and any other relevant parameters, such as `project_id`), your backend should exchange the authorization code for an access token using the OAuth2 token endpoint:

```ts
const tokenResponse = await fetch('https://auth.prisma.io/token', {
  method: 'POST',
  headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
  body: new URLSearchParams({
    grant_type: 'authorization_code',
    code: code, // The code received from the callback
    redirect_uri: 'https://your-app.com/auth/callback', // Must match the redirect_uri used in step 3
    client_id: YOUR_CLIENT_ID,
    client_secret: YOUR_CLIENT_SECRET,
  }).toString(),
});
const tokenData = await tokenResponse.json();
```

Once you have the user's access token, call the Partner API transfer endpoint to move the project to the selected workspace. You will need the `project_id` and the access token you just obtained:

```ts
const transferResponse = await fetch(`https://api.prisma.io/v1/projects/${project_id}/transfer`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    Authorization: `Bearer ${YOUR_INTEGRATION_TOKEN}`,
  },
  body: JSON.stringify({ recipientAccessToken: tokenData.access_token }),
});
```

If the transfer is successful, the database is now owned by the user's workspace.

## Summary

- All API calls, redirects, and error handling are implemented as shown in the code above.
- OAuth2 is used to securely transfer ownership of the database to your workspace.
- The [create-db](https://github.com/prisma/create-db) repo is a reference for how to use the Partner API in your own projects.

## Next Steps

- Explore [Prisma ORM documentation](/orm/overview/introduction) to learn more about working with your new database.
- Try connecting your application to the database using the provided connection strings.
- Learn about [Prisma Accelerate](/postgres/database/caching) for improved performance.
- Join the [Prisma community on Discord](https://pris.ly/discord) for support and tips.