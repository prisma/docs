---
title: 'Deploying your Serverless Framework project'
metaTitle: 'Deploying your Serverless Framework project'
metaDescription: 'Learn how to avoid potential pitfalls when deploying your Serverless Framework project using Prisma'
---

<TopBlock>

This guide explains how to avoid common issues when deploying a [Serverless Framework](https://www.serverless.com/framework/) project with Prisma. For a guide on how to get started with Serverless Framework, we recommend [Setting Up Serverless Framework With AWS](https://www.serverless.com/framework/docs/getting-started).

</TopBlock>

## Prerequisites

- An existing Serverless Framework project with Prisma.

## Things to know

While Prisma works well with the Serverless Framework "out of the box", there are a few improvements that can be made within your project to ensure a smooth deployment and performance.

### Deploy only the required files

To reduce your deployment footprint, you can change your deployment process so that you only upload the files that your application needs. The Serverless configuration file `serverless.yml` includes a package pattern that includes only the Prisma engine binary relevant to the Lambda runtime, and excludes the others. This means that when Serverless packages your app for upload, it includes only one binary. This ensures the packaged archive is as small as possible.

```code file=serverless.yml no-copy
package:
  patterns:
    - '!node_modules/.prisma/client/libquery_engine-*'
    - 'node_modules/.prisma/client/libquery_engine-rhel-*'
    - '!node_modules/prisma/libquery_engine-*'
    - '!node_modules/@prisma/engines/**'
```

However, if you use `serverless-webpack`, then you cannot use this method. See [Deployment with serverless webpack](#deployment-with-serverless-webpack) for details.

### Deployment with <inlinecode>serverless-webpack</inlinecode>

If you use `serverless-webpack`, then you can use the [serverless-webpack-prisma](https://github.com/danieluhm2004/serverless-webpack-prisma) plugin without any additional configuration. `serverless-webpack-prisma` does the following:

1. Copies your `schema.prisma` with the Webpack plugin.
2. Runs the `prisma generate` command. This means that there is no need to add the command to the webpack options separately.
3. Packages the correct Prisma engine binary. This can save more than 40mb of capacity.

<details><summary>If you would like to start using webpack...</summary>

Install the dependencies as follows:

```sh
npm install -D webpack serverless-webpack webpack-node-externals
```

If your project uses TypeScript, install `ts-loader`:

```sh
npm install -D ts-loader
```

Create a `webpack.config.js` file in the project root directory, and paste in the following configuration:

```javascript file=webpack.config.js
/* eslint-disable @typescript-eslint/no-var-requires */
const path = require('path')
const nodeExternals = require('webpack-node-externals')
const slsw = require('serverless-webpack')
const { isLocal } = slsw.lib.webpack

module.exports = {
  target: 'node',
  stats: 'normal',
  entry: slsw.lib.entries,
  externals: [nodeExternals()],
  mode: isLocal ? 'development' : 'production',
  optimization: { concatenateModules: false },
  resolve: { extensions: ['.js'] },
  output: {
    libraryTarget: 'commonjs',
    filename: '[name].js',
    path: path.resolve(__dirname, '.webpack'),
  },
}
```

If you use TypeScript, insert the following configuration inside `exports`:

```javascript file=webpack.config.js
// ...initial config
module.exports = {
  // ...initial config
  resolve: { extensions: ['.js', '.ts'] },
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        loader: 'ts-loader',
        exclude: /node_modules/,
      },
    ],
  },
  // ...initial config
}
```

Refer to the [Serverless Webpack documentation](https://www.serverless.com/plugins/serverless-webpack) for additional configuration.

</details>

To install the dev dependency, use the following command:

```sh
npm install -D serverless-webpack-prisma serverless
```

In `serverless.yml`, add `serverless-webpack-prisma` to the plugins list, as follows:

```yaml file=serverless.yml
plugins:
  - serverless-webpack
  - serverless-webpack-prisma

custom:
  webpack:
    includeModules: true
```

`serverless-webpack-prisma` automatically runs `prisma generate` so that you do not need to use the webpack script option separately as shown below.

```yaml file=serverless.yml
custom:
  webpack:
    packagerOptions:
      scripts:
        - prisma generate
```

`serverless-webpack-prisma` removes the unnecessary dependencies and packages the correct Prisma engine binary. Therefore, delete it in the `package.patterns` configuration in your `serverless.yml` file.

```yaml file=serverless.yml
package:
  patterns:
    - '!node_modules/.prisma/client/libquery_engine-*'
    - 'node_modules/.prisma/client/libquery_engine-rhel-*'
    - '!node_modules/prisma/libquery_engine-*'
    - '!node_modules/@prisma/engines/**'
```

Now redeploy your application. To do so, run `serverless deploy`. The deployment output shows you that the correct Prisma engine binary is packaged and distributed, as follows:

```code no-copy
Serverless: Copy prisma schema for app...
Serverless: Generate prisma client for app...
Serverless: Remove unused prisma engine:
Serverless: - node_modules/.prisma/client/libquery_engine-darwin.dylib.node
Serverless: - node_modules/@prisma/engines/libquery_engine-darwin.dylib.node
Serverless: - node_modules/@prisma/engines/migration-engine-darwin
Serverless: - node_modules/@prisma/engines/prisma-fmt-darwin
Serverless: Copying existing artifacts...
```

### Binary targets in <inlinecode>schema.prisma</inlinecode>

The Prisma schema should contain the following in the `generator` block:

```prisma
binaryTargets = ["native", "rhel-openssl-1.0.x"]
```

This is necessary because the local runtime is different from the Lambda runtime. Add the [`binaryTarget`](/reference/api-reference/prisma-schema-reference#binarytargets-options) to make the compatible Prisma engine binary available.

#### Lambda functions with arm64 architectures

Lambda functions that use [arm64 architectures (AWS Graviton2 processor)](https://docs.aws.amazon.com/lambda/latest/dg/foundation-arch.html#foundation-arch-adv) must use an `arm64` precompiled binary.

In the `generator` block of your `schema.prisma` file, add the following:

```prisma file=schema.prisma
binaryTargets = ["native", "linux-arm64-openssl-1.0.x"]
```

Update the Serverless configuration file to package the `arm64` binary, as follows:

```code file=serverless.yml
package:
  patterns:
    - '!node_modules/.prisma/client/libquery_engine-*'
    - 'node_modules/.prisma/client/libquery_engine-linux-arm64-*'
    - '!node_modules/prisma/libquery_engine-*'
    - '!node_modules/@prisma/engines/**'
```

### Connection pooling

Generally, when you use a FaaS (function as a service) environment to interact with a database, every function invocation can result in a new connection to the database. This is not a problem with a constantly running node.js server. Therefore, it is beneficial to pool DB connections to get better performance. You can use the [Data Proxy](/data-platform/data-proxy) as a solution to this issue. For other solutions, see the [connection management guide for serverless environments](/guides/performance-and-optimization/connection-management#serverless-environments-faas).

## Summary

Congratulations! You have successfully deployed your Serverless Framework application with Prisma!

For more insight into the Prisma Client API, [check out our API reference](/reference/api-reference/prisma-client-reference) or connect with us on [GitHub](https://github.com/prisma/prisma), [Slack](https://slack.prisma.io), or [Discord](https://pris.ly/discord)
