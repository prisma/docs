---
title: 'Migration flows'
metaTitle: 'Migration flows (Concepts)'
metaDescription: 'Prisma Migrate is a declarative data modeling and schema migration tool that is available via the Prisma CLI.'
---

<TopBlock>

</TopBlock>

## Modifying a migration

You can choose to change the behavior of a migration **when you create it**. For example, Prisma Migrate cannot automatically detect that you want to _rename_ a field - instead, it will add a new field and remove the old one. To rename the field instead (for example, `name` &rarr; `fullname`), you must create and modify a **draft migration**:

1. Make a change to your schema - for example, renaming a field:
 
    ```prisma file=schema.prisma
    model User {
    +  fullname String?
    -  name     String?
    }
    ```

1. Use the `--create-only` option to generate a **draft** migration:

    <CodeWithResult>
    <Cmd>

    ```terminal
    prisma migrate dev --create-only --preview-feature
    ```
    </Cmd>
    <CmdResult>
    ```
    Prisma Migrate created the following migration without applying it 20201208100950_fullname_field
    ```    
    </CmdResult>
    </CodeWithResult>

    Prisma Migrate does not apply this migration.

2. Edit the generated `20201208100950_fullname_field/migration.sql` file:

   ```sql
   ALTER TABLE "User" DROP COLUMN "name",
   - ADD COLUMN     "fullname" TEXT,
   + RENAME "name" TO  "fullname"
   ```

3. Apply the migration:

   ```terminal
   prisma migrate dev --preview-feature
   ```

## Collaborating with a team

To bring in changes to the database schema and migrations from collaborators, pull the changed Prisma Schema and the new migration files. Run `prisma migrate dev` to apply the changes. Running this command:

1. Checks if there are any migrations that have not yet been applied and applies those migrations
1. Checks for changes in the Prisma schema - if there are changes, Prisma creates and applies new migrations

## Handling migration history conflicts

A migration history conflict occurs when there are discrepancies between the **migrations folder in the file system** and the **`_prisma_migrations` table in the database**. This can happen if:

* A migration that has already been applied is later modified - for example, adding a comment or modifying the actual SQL of a `migration.sql` file. The SQL statement in the `migration.sql` file and the `_prisma_migrations` table are now different, resulting in a conflict.
* A migration that has already been applied is missing from the file system.  This can occur if you switch branches without committing your migrations, or as a result of a `git merge` issue.

### Option 1: Drop and recreate the database

If Prisma Migrate detects a migration history conflict when you run `prisma migrate dev`, the CLI will ask to reset the database. Resetting the database:

1. Drops the database
2. Recreates the database
3. Applies all migrations

This approach makes sense if you modified a migrations file on purpose to do something that cannot be done via the Prisma Schema - for example, create a new column with an unsupported type.

### Option 2: Manually resolve conflict

If Prisma Migrate detects a migration history conflict when you run `prisma migrate dev`, you can deny the reset and manually reconcile the differences between your migrations folder and the `_prisma_migrations` table. For example:

* Manually recreate a missing migrations files from the relevant `script` and `migration_name` fields in the `_prisma_migrations` table 
* Change statement in relevant `script` field in the `_prisma_migrations` table to match the change you made to the `migrations.sql` file

This approach makes sense if the conflict was the result of a mistake or a very small change that is not worth dropping and recreating the database.

## Handling database schema drift

Database schema drift occurs when your database schema is out of sync with your migration history - the database schema has 'drifted away' from the source of truth, which should be your migration history. Schema drift can occur if:

* The database schema was changed _without_ using migrations - for example, by using [`prisma db push`](../../reference/api-reference/command-reference#db-push) or manually changing the database schema.

The following scenario assume that you made a manual change in production and want to propagate that change to your migration history and other databases.

### Development environments

1. Make an equivalent change in the Prisma schema - for example, adding a field named `bio` and an index:

  ```prisma
  model User {
      bio   String?

      @@index([bio])
  }
  ```

1. Create and apply the new migration in dev:

   ```terminal
   prisma migrate dev
   ```   

1. Commit the new migration and allow your CI process to apply the migration to all other non-production databases.

### Production environments

When the manual change has been replicated in the Prisma schema, you must reconcile your migration history and database schema in production:

1. Mark the migration as 'already applied' so that Prisma Migrate does not try to create a field and index that already exists:

   ```terminal
   prisma migrate resolve --applied "20201127134938_added_bio_index"
   ```

   This command adds the migration to the migration history table without running the actual SQL.

## Handling a failed migration

A migration might fail if:

* You [modify a draft migration]() and introduce a syntax error
* You add a mandatory (`NOT NULL`) column to a table that already has data
* The migration process stopped unexpectedly
* The database shut down in the middle of the migration process

1. 

   ```terminal
   prisma migrate resolve --applied "20201127134938_my_migration"
   ```

### Option 1: Roll back, 

## Baselining a database

**Baselining**

## Hotfixing a database

**Hotfixing** a database

* You had to make a change in production - e.g. add an index to a db that was very slow
* You now want to reconcile your migration history and production db

See this example.