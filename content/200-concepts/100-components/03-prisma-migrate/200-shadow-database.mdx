---
title: Shadow database
---

<TopBlock>

Prisma Migrate uses a second, _temporary_ database when you run development-focused commands such as:

* `prisma migrate dev`
* `prisma migrate reset`

The shadow database and is **created and deleted automatically**\* each time you run a development-focused command and is primarily used to **detect problems** such a schema drift.

<FootNote>

\* If use a cloud-hosted database for development, you need to [create the shadow database manually](#cloud-hosted-shadow-databases-must-be-created-manually).

</FootNote>

> **Important**: The shadow database is **not** required in production, and is not used by production-focused commands such as `prisma migrate resolve` and `prisma migrate deploy`.

</TopBlock>

## How the shadow database works

When you run `prisma migrate dev` to create a new migration, Prisma Migrate:

1. Replays the **current** migration history in the shadow database.
2. **Introspects** the shadow database to generate the 'current state' of you Prisma schema.
2. Compares the end state of the current migration history to the development database
3. Test test test

## Shadow database user permissions

In order to create and delete the shadow database when using development commands such as `migrate dev` and `migrate reset`, Prisma Migrate currently requires that the database user defined in your `datasource` has permission to **create databases**.

| Database   | Database user requirements                                                                                                                                                                                            |
| ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| SQLite     | No special requirements.                                                                                                                                                                                              |
| MySQL      | Database user must have `CREATE, ALTER, DROP, REFERENCES ON *.*` privileges                                                                                                                                                                       |
| PostgreSQL | The user must be a super user or have `CREATEDB` privilege. See `CREATE ROLE` ([PostgreSQL official documentation](https://www.postgresql.org/docs/12/sql-createdatabase.html))                                       |
| SQL Server | The user must be a site admin or have the `SERVER` securable. See the [official documentation](https://docs.microsoft.com/en-us/sql/relational-databases/security/permissions-database-engine?view=sql-server-ver15). |

> If you use a cloud-hosted database for development, see: [Cloud-hosted shadow databases](#cloud-hosted-shadow-databases-must-be-created-manually)

Prisma Migrate throws the following error if it cannot create the shadow database with the credentials your connection string supplied:

```
Error: A migration failed when applied to the shadow database
Database error: Error querying the database: db error: ERROR: permission denied to create database
```

The resolve this error:

- If you are working locally, we recommend that you change the database user's privileges.
- If you are developing against a cloud-based database (for example, on Heroku), we recommend that you change to a local web environment (such as running your development database on Docker) for the time being and follow the discussions on [GitHub issue #4571](https://github.com/prisma/prisma/issues/4571).
- If you are developing against a cloud-based database (for example, on Heroku) and **cannot** switch, please remain on version 2.12.0 and follow the discussions on [GitHub issue #4571](https://github.com/prisma/prisma/issues/4571).
- If you are developing against a cloud-based database (for example, on Heroku) and are currently **prototyping** such that you don't care about generated migration files and only need to apply your Prisma data model to the database schema, you can run [`prisma db push`](../../../reference/api-reference/command-reference#db) instead of the `prisma migrate dev` command.

> **Important**: The shadow database is _only_ required in a development environment (specifically for the `prisma migrate dev` command) - you **do not** need to make any changes to your production environment.

## Cloud-hosted shadow databases must be created manually

Cloud providers do not generally allow you to drop and create databases. If you **develop** in a cloud-hosted environment:

1. Create a dedicated cloud-hosted shadow database
2. Add the URL to the [`shadowDatabaseUrl`](../../../reference/api-reference/prisma-schema-reference#datasource) <span class="api"></span> field:

```prisma highlight=4;normal
datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}
```
