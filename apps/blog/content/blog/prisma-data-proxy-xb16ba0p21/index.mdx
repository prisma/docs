---
title: "Database Access in Serverless Environments with the Prisma Data Proxy"
slug: "prisma-data-proxy-xb16ba0p21"
date: "2021-11-11"
authors:
  - "Nikolas Burk"
  - "Alberto Perdomo"
metaTitle: "Database Access in Serverless Environments with the Prisma Data Proxy (Early Access)"
metaDescription: "The Prisma Data Proxy (Early Access) enables developers to use databases in serverless environments by managing a connection pool."
metaImagePath: "/blog/prisma-data-proxy-xb16ba0p21/imgs/meta-3fc1d1f448cde60bd38e28c64d061ce7fb171f81-2400x1254.png"
heroImagePath: "/blog/prisma-data-proxy-xb16ba0p21/imgs/hero-bb301a00397c84e302d829b963462d00950d326e-870x455.png"
heroImageAlt: "Database Access in Serverless Environments with the Prisma Data Proxy"
excerpt: |
  Databases connection management in serverless functions is a major issue for many developers. The Prisma Data Proxy (Early Access) solves this problem by managing a connection pool.

---


> **Data Proxy will be discontinued on December 31, 2023.** For a seamless transition, we recommend exploring [Prisma Accelerate](https://www.prisma.io/data-platform/accelerate), which offers connection pooling, global caching and enables usage of Prisma Client in edge functions.

## Contents

- [Serverless enables fast development](#serverless-enables-fast-development)
- [_Stateful_ database connections don't map well to _stateless_ serverless functions](#stateful-database-connections-dont-map-well-to-stateless-serverless-functions)
- [Connection pooling to the rescue](#connection-pooling-to-the-rescue)
- [Announcing the Prisma Data Proxy ðŸŽ‰](#announcing-the-prisma-data-proxy-)
- [Let us know what you think](#let-us-know-what-you-think)


---

<Youtube videoId="GWbzyyziH9A" />

---

## Serverless enables fast development

[Serverless](https://www.prisma.io/dataguide/serverless/what-is-serverless) functions are an incredibly convenient tool that allow developers to quickly implement and deploy functionality that can then be invoked via HTTP requests.

A drastically reduced operational overhead, easy scaling thanks to the dynamic allocation of computational resources, and a consumption-based pricing model are more features of serverless functions that explain their popularity among developers.

Serverless is also integrated into frameworks like Next.js where an entire backend can be implemented via [API routes](https://nextjs.org/docs/pages/building-your-application/routing/api-routes). Deployed to serverless platforms like Vercel, every API route is mapped to a serverless function to handle incoming requests.

---

## _Stateful_ database connections don't map well to _stateless_ serverless functions

However, as developers started to harness serverless functions for the use case of building their backends, they ran into an issue.

### Accessing a database from a serverless function

Serverless functions are short-lived, ephemeral and rarely get reused. This means that as traffic spikes, the number of instances of a serverless function goes up as well.

This _stateless_ nature of serverless functions doesn't map well to the _statefulness_ of traditional databases that require a TCP connection between application and database server. This connection itself is kept open in memory and thus is part of the _application state_.

Let's quickly understand the exact issues that arise when talking to a database from serverless functions.

When a serverless function needs to access a database, it establishes a connection to it, submits a query and receives the response from the database. The response data is then delivered to the client that invoked the serverless function, the database connection is closed and the function is torn down again.

<TweetEmbedComp tweets={["1430177184015073281"]} convState={false}/>

### Serverless functions exhaust the connection limit

If the number of parallel function invocations is low, there are no issues. However, during traffic spikes, it can happen that _a lot_ of parallel functions are spawned, each requiring its own database connection.

![](/blog/prisma-data-proxy-xb16ba0p21/imgs/9OuYJ08.png)

Traditional databases like PostgreSQL and MySQL typically have a _database connection limit_ that can easily get exhausted in these situations. Once the database can't accept any new connections from newly spawned serverless functions, the requests made by the client applications start to fail.

### Opening and closing a connection per request is slow

Another issue in this context is that the opening and closing of database connections is a fairly expensive operation to perform due to TLS termination and resource allocation for the connection in the database. This adds to the already existing problem of _cold starts_ in serverless functions and slows down the execution of a request even more.

So besides the exhaustion of the database connection limit, performance can be impacted by the fact that database connections do not get reused.

---

## Connection pooling to the rescue

The solution to the problems named above is called _connection pooling_. By creating a pool of database connections, it is ensured that database connections can be reused and pressure on the database is managed appropriately.

### Traditional servers can maintain a connection pool

In traditional, server-based applications, managing a connection pool is not a problem because the server is able to maintain its state. In serverless functions, however, it is not possible to maintain a connection pool across incoming requests because of the stateless nature of the functions.

### Serverless functions need an _external_ connection pool

The only solution for serverless functions to get around the problem of database connection management is to introduce a proxy server in front of the database that manages a connection pool.

Existing tools like [pgBouncer](https://www.pgbouncer.org/) for PostgreSQL require notable overhead in managing an additional infrastructure component.

---

## Announcing the Prisma Data Proxy ðŸŽ‰

The [Prisma Data Proxy](https://www.prisma.io/docs/data-platform#prisma-data-proxy) is a proxy server for your database that manages a connection pool and ensures existing database connections are reused. This prevents incoming user requests from failing and improves the performance of your app.

![](/blog/prisma-data-proxy-xb16ba0p21/imgs/6GJ9C84.png)

The Data Proxy integrates nicely with the Prisma ORM and can be enabled in a few simple steps via the [Prisma Data Platform](https://cloud.prisma.io).

> **Note**: The Prisma Data Proxy is currently in [Early Access](https://www.prisma.io/docs/about/prisma/releases#early-access) and not yet recommended for production use.

To learn how the Data Proxy works, check out [Daniel Norman's](https://twitter.com/daniel2color) recent talk about it:

<Youtube videoId="iyGZ8JFPgoY" />

The Data Proxy also enables entirely new use cases, such as accessing a database from limited function environments such as [Cloudflare Workers](https://workers.cloudflare.com/). Follow the [guide](https://www.prisma.io/docs/guides/deployment/deployment-guides/deploying-to-cloudflare-workers) in our docs to learn more or watch the [demo](https://youtu.be/Ufe_tI_jJs8?t=380) from our recent "What's new in Prisma"-livestream.

## Let us know what you think

You can try out the Prisma Data Proxy today by enabling it on the [Prisma Data Platform](https://cloud.prisma.io).

<br />
<br />
[Try the Prisma Data Proxy](https://cloud.prisma.io)


We are hosting our first [Serverless Data Conference](https://www.prisma.io/serverless) on **November 18th** with fantastic speakers from companies like Vercel, Netlify, MongoDB and Cloudflare. Join us to learn more about the Data Proxy and other awesome features that are planned for the [Prisma Data Platform](https://cloud.prisma.io).


